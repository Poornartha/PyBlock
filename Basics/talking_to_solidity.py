from web3 import Web3

web3 = Web3(Web3.HTTPProvider("HTTP://127.0.0.1:7545"))

web3.eth.defaultAccount = web3.eth.accounts[0]

# ABI of Solidity file would be present in WEb3 Provider info. Set deployment to web3 provider.
abi = '[{"constant":false,"inputs":[{"name":"_greeting","type":"string"}],"name":"setGreeting","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"greeting","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getGreeting","outputs":[{"name":"greetings","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]'

bytecode = "608060405234801561001057600080fd5b506040805190810160405280600b81526020017f48656c6c6f20576f726c640000000000000000000000000000000000000000008152506000908051906020019061005c929190610062565b50610107565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a357805160ff19168380011785556100d1565b828001600101855582156100d1579182015b828111156100d05782518255916020019190600101906100b5565b5b5090506100de91906100e2565b5090565b61010491905b808211156101005760008160009055506001016100e8565b5090565b90565b610469806101166000396000f3fe608060405260043610610051576000357c010000000000000000000000000000000000000000000000000000000090048063a413686214610056578063ef690cc01461011e578063fe50cc72146101ae575b600080fd5b34801561006257600080fd5b5061011c6004803603602081101561007957600080fd5b810190808035906020019064010000000081111561009657600080fd5b8201836020820111156100a857600080fd5b803590602001918460018302840111640100000000831117156100ca57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929050505061023e565b005b34801561012a57600080fd5b50610133610258565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610173578082015181840152602081019050610158565b50505050905090810190601f1680156101a05780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156101ba57600080fd5b506101c36102f6565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102035780820151818401526020810190506101e8565b50505050905090810190601f1680156102305780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b8060009080519060200190610254929190610398565b5050565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102ee5780601f106102c3576101008083540402835291602001916102ee565b820191906000526020600020905b8154815290600101906020018083116102d157829003601f168201915b505050505081565b606060008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561038e5780601f106103635761010080835404028352916020019161038e565b820191906000526020600020905b81548152906001019060200180831161037157829003601f168201915b5050505050905090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106103d957805160ff1916838001178555610407565b82800160010185558215610407579182015b828111156104065782518255916020019190600101906103eb565b5b5090506104149190610418565b5090565b61043a91905b8082111561043657600081600090555060010161041e565b5090565b9056fea165627a7a7230582011bbe46079e4e2c1db4d762816b2fefb304257ca24f63c7361d22f1b1c82f0e20029"

Greeter = web3.eth.contract(abi=abi, bytecode=bytecode)

# Find txn_hash:

txn_hash = Greeter.constructor().transact()
print(web3.toHex(txn_hash))

# Getting Transaction Receipt:
txn_receipt = web3.eth.waitForTransactionReceipt(txn_hash)
print(txn_receipt)

# Connecting to the contract
contract = web3.eth.contract(
    address=txn_receipt.contractAddress,
    abi=abi,
)

print(contract.functions.getGreeting().call())

# Set value:
txn_hash = contract.functions.setGreeting("Hello").transact()
txn_receipt = web3.eth.waitForTransactionReceipt(txn_hash)

print(txn_receipt)

print(contract.functions.getGreeting().call())